<?php

use Lacodix\LaravelPlans\Classes\Period;
use Lacodix\LaravelPlans\Enums\Interval;

it('calculates period correct', function ($interval, $period, $input, $expectedStart, $expectedEnd) {
    $period = new Period($interval, $period, $input);

    expect($period)->getStartDate()->toBeCarbon($expectedStart)
        ->getEndDate()->toBeCarbon($expectedEnd);
})->with([
    'month' => [Interval::MONTH, 1, '2020-01-01 12:00:00', '2020-01-01 00:00:00', '2020-01-31 23:59:59'],
    'month_middle_of' => [Interval::MONTH, 1, '2020-01-12 23:59:00', '2020-01-12 00:00:00', '2020-02-11 23:59:59'],
    'month_end_no_of' => [Interval::MONTH, 1, '2020-02-29 23:59:00', '2020-02-29 00:00:00', '2020-03-28 23:59:59'],
    'month_end_with_of' => [Interval::MONTH, 1, '2020-01-31 23:59:00', '2020-01-31 00:00:00', '2020-02-28 23:59:59'],

    '2months' => [Interval::MONTH, 2, '2020-01-01 12:00:00', '2020-01-01 00:00:00', '2020-02-29 23:59:59'],
    '2months_middle_of' => [Interval::MONTH, 2, '2020-01-12 23:59:00', '2020-01-12 00:00:00', '2020-03-11 23:59:59'],
    '2months_end_no_of' => [Interval::MONTH, 2, '2020-02-29 23:59:00', '2020-02-29 00:00:00', '2020-04-28 23:59:59'],
    '2months_end_with_of' => [Interval::MONTH, 2, '2020-01-31 23:59:00', '2020-01-31 00:00:00', '2020-03-30 23:59:59'],

    '3months' => [Interval::MONTH, 3, '2020-01-01 12:00:00', '2020-01-01 00:00:00', '2020-03-31 23:59:59'],
    '3months_middle_of' => [Interval::MONTH, 3, '2020-01-12 23:59:00', '2020-01-12 00:00:00', '2020-04-11 23:59:59'],
    '3months_end_no_of' => [Interval::MONTH, 3, '2020-02-29 23:59:00', '2020-02-29 00:00:00', '2020-05-28 23:59:59'],
    '3months_end_with_of' => [Interval::MONTH, 3, '2020-01-31 23:59:00', '2020-01-31 00:00:00', '2020-04-29 23:59:59'],

    'bi_month' => [Interval::TWO_MONTHS, 1, '2020-01-01 12:00:00', '2020-01-01 00:00:00', '2020-02-29 23:59:59'],
    'bi_month_middle_of' => [Interval::TWO_MONTHS, 1, '2020-01-15 23:59:00', '2020-01-15 00:00:00', '2020-03-14 23:59:59'],
    'bi_month_end_no_of' => [Interval::TWO_MONTHS, 1, '2020-02-29 23:59:00', '2020-02-29 00:00:00', '2020-04-28 23:59:59'],
    'bi_month_end_with_of' => [Interval::TWO_MONTHS, 1, '2020-01-31 23:59:00', '2020-01-31 00:00:00', '2020-03-30 23:59:59'],

    '2bi_month' => [Interval::TWO_MONTHS, 2, '2020-01-01 12:00:00', '2020-01-01 00:00:00', '2020-04-30 23:59:59'],
    '2bi_month_middle_of' => [Interval::TWO_MONTHS, 2, '2020-01-15 23:59:00', '2020-01-15 00:00:00', '2020-05-14 23:59:59'],
    '2bi_month_end_no_of' => [Interval::TWO_MONTHS, 2, '2020-02-29 23:59:00', '2020-02-29 00:00:00', '2020-06-28 23:59:59'],
    '2bi_month_end_with_of' => [Interval::TWO_MONTHS, 2, '2020-01-31 23:59:00', '2020-01-31 00:00:00', '2020-05-30 23:59:59'],

    '3bi_month' => [Interval::TWO_MONTHS, 3, '2020-01-01 12:00:00', '2020-01-01 00:00:00', '2020-06-30 23:59:59'],
    '3bi_month_middle_of' => [Interval::TWO_MONTHS, 3, '2020-01-15 23:59:00', '2020-01-15 00:00:00', '2020-07-14 23:59:59'],
    '3bi_month_end_no_of' => [Interval::TWO_MONTHS, 3, '2020-02-29 23:59:00', '2020-02-29 00:00:00', '2020-08-28 23:59:59'],
    '3bi_month_end_with_of' => [Interval::TWO_MONTHS, 3, '2020-01-31 23:59:00', '2020-01-31 00:00:00', '2020-07-30 23:59:59'],

    'day' => [Interval::DAY, 1, '2020-01-11 12:00:00', '2020-01-11 00:00:00', '2020-01-11 23:59:59'],
    'day_middle_of' => [Interval::DAY, 1, '2020-01-11 23:59:00', '2020-01-11 00:00:00', '2020-01-11 23:59:59'],
    'day_end_no_of' => [Interval::DAY, 1, '2020-01-11 23:59:00', '2020-01-11 00:00:00', '2020-01-11 23:59:59'],
    'day_end_with_of' => [Interval::DAY, 1, '2020-01-11 23:59:00', '2020-01-11 00:00:00', '2020-01-11 23:59:59'],

    '2day' => [Interval::DAY, 2, '2020-01-11 12:00:00', '2020-01-11 00:00:00', '2020-01-12 23:59:59'],
    '3day' => [Interval::DAY, 3, '2020-01-11 12:00:00', '2020-01-11 00:00:00', '2020-01-13 23:59:59'],

    'half_year' => [Interval::HALF_YEAR, 1, '2020-01-01 12:00:00', '2020-01-01 00:00:00', '2020-06-30 23:59:59'],
    'half_year_middle_of' => [Interval::HALF_YEAR, 1, '2020-06-15 23:59:00', '2020-06-15 00:00:00', '2020-12-14 23:59:59'],
    'half_year_end_no_of' => [Interval::HALF_YEAR, 1, '2020-02-29 23:59:00', '2020-02-29 00:00:00', '2020-08-28 23:59:59'],
    'half_year_end_with_of' => [Interval::HALF_YEAR, 1, '2020-01-31 23:59:00', '2020-01-31 00:00:00', '2020-07-30 23:59:59'],

    '2half_year' => [Interval::HALF_YEAR, 2, '2020-01-01 12:00:00', '2020-01-01 00:00:00', '2020-12-31 23:59:59'],
    '2half_year_middle_of' => [Interval::HALF_YEAR, 2, '2020-06-15 23:59:00', '2020-06-15 00:00:00', '2021-06-14 23:59:59'],
    '2half_year_end_no_of' => [Interval::HALF_YEAR, 2, '2020-02-29 23:59:00', '2020-02-29 00:00:00', '2021-02-27 23:59:59'],
    '2half_year_end_with_of' => [Interval::HALF_YEAR, 2, '2020-01-31 23:59:00', '2020-01-31 00:00:00', '2021-01-30 23:59:59'],

    '3half_year' => [Interval::HALF_YEAR, 3, '2020-01-01 12:00:00', '2020-01-01 00:00:00', '2021-06-30 23:59:59'],
    '3half_year_middle_of' => [Interval::HALF_YEAR, 3, '2020-06-15 23:59:00', '2020-06-15 00:00:00', '2021-12-14 23:59:59'],
    '3half_year_end_no_of' => [Interval::HALF_YEAR, 3, '2020-02-29 23:59:00', '2020-02-29 00:00:00', '2021-08-28 23:59:59'],
    '3half_year_end_with_of' => [Interval::HALF_YEAR, 3, '2020-01-31 23:59:00', '2020-01-31 00:00:00', '2021-07-30 23:59:59'],

    'year' => [Interval::YEAR, 1, '2020-01-01 12:00:00', '2020-01-01 00:00:00', '2020-12-31 23:59:59'],
    'year_middle_of' => [Interval::YEAR, 1, '2020-06-15 23:59:00', '2020-06-15 00:00:00', '2021-06-14 23:59:59'],
    'year_end_no_of' => [Interval::YEAR, 1, '2020-02-29 23:59:00', '2020-02-29 00:00:00', '2021-02-27 23:59:59'],
    'year_end_with_of' => [Interval::YEAR, 1, '2020-01-31 23:59:00', '2020-01-31 00:00:00', '2021-01-30 23:59:59'],

    '2year' => [Interval::YEAR, 2, '2020-01-01 12:00:00', '2020-01-01 00:00:00', '2021-12-31 23:59:59'],
    '2year_middle_of' => [Interval::YEAR, 2, '2020-06-15 23:59:00', '2020-06-15 00:00:00', '2022-06-14 23:59:59'],
    '2year_end_no_of' => [Interval::YEAR, 2, '2020-02-29 23:59:00', '2020-02-29 00:00:00', '2022-02-27 23:59:59'],
    '2year_end_with_of' => [Interval::YEAR, 2, '2020-01-31 23:59:00', '2020-01-31 00:00:00', '2022-01-30 23:59:59'],
    '4year_end_no_of' => [Interval::YEAR, 4, '2020-02-29 23:59:00', '2020-02-29 00:00:00', '2024-02-28 23:59:59'],

    'quarter' => [Interval::QUARTER, 1, '2020-01-01 12:00:00', '2020-01-01 00:00:00', '2020-03-31 23:59:59'],
    'quarter_middle_of' => [Interval::QUARTER, 1, '2020-06-15 23:59:00', '2020-06-15 00:00:00', '2020-09-14 23:59:59'],
    'quarter_end_no_of' => [Interval::QUARTER, 1, '2020-02-29 23:59:00', '2020-02-29 00:00:00', '2020-05-28 23:59:59'],
    'quarter_end_with_of' => [Interval::QUARTER, 1, '2020-01-31 23:59:00', '2020-01-31 00:00:00', '2020-04-29 23:59:59'],

    '2quarter' => [Interval::QUARTER, 2, '2020-01-01 12:00:00', '2020-01-01 00:00:00', '2020-06-30 23:59:59'],
    '2quarter_middle_of' => [Interval::QUARTER, 2, '2020-06-15 23:59:00', '2020-06-15 00:00:00', '2020-12-14 23:59:59'],
    '2quarter_end_no_of' => [Interval::QUARTER, 2, '2020-02-29 23:59:00', '2020-02-29 00:00:00', '2020-08-28 23:59:59'],
    '2quarter_end_with_of' => [Interval::QUARTER, 2, '2020-01-31 23:59:00', '2020-01-31 00:00:00', '2020-07-30 23:59:59'],

    '3quarter' => [Interval::QUARTER, 3, '2020-01-01 12:00:00', '2020-01-01 00:00:00', '2020-09-30 23:59:59'],
    '3quarter_middle_of' => [Interval::QUARTER, 3, '2020-06-15 23:59:00', '2020-06-15 00:00:00', '2021-03-14 23:59:59'],
    '3quarter_end_no_of' => [Interval::QUARTER, 3, '2020-02-29 23:59:00', '2020-02-29 00:00:00', '2020-11-28 23:59:59'],
    '3quarter_end_with_of' => [Interval::QUARTER, 3, '2020-01-31 23:59:00', '2020-01-31 00:00:00', '2020-10-30 23:59:59'],
    '4quarter_end_no_of' => [Interval::QUARTER, 4, '2020-02-29 23:59:00', '2020-02-29 00:00:00', '2021-02-27 23:59:59'],

    'week' => [Interval::WEEK, 1, '2020-01-01 12:00:00', '2020-01-01 00:00:00', '2020-01-07 23:59:59'],
    'week_middle_of' => [Interval::WEEK, 1, '2020-02-27 23:59:00', '2020-02-27 00:00:00', '2020-03-04 23:59:59'],

    '2week' => [Interval::WEEK, 2, '2020-01-01 12:00:00', '2020-01-01 00:00:00', '2020-01-14 23:59:59'],
    '2week_middle_of' => [Interval::WEEK, 2, '2020-02-27 23:59:00', '2020-02-27 00:00:00', '2020-03-11 23:59:59'],

    '3week' => [Interval::WEEK, 3, '2020-01-01 12:00:00', '2020-01-01 00:00:00', '2020-01-21 23:59:59'],
    '3week_middle_of' => [Interval::WEEK, 3, '2020-02-27 23:59:00', '2020-02-27 00:00:00', '2020-03-18 23:59:59'],
]);

it('moves period to earlier date from step to step', function () {
    $period = new Period(Interval::MONTH, 1, '2020-01-31 12:00:00');

    expect($period)->getStartDate()->toBeCarbon('2020-01-31 00:00:00')
        ->getEndDate()->toBeCarbon('2020-02-28 23:59:59');

    $period = new Period(Interval::MONTH, 1, $period->getEndDate()->addSecond());

    expect($period)->getStartDate()->toBeCarbon('2020-02-29 00:00:00')
        ->getEndDate()->toBeCarbon('2020-03-28 23:59:59');

    $period = new Period(Interval::MONTH, 1, $period->getEndDate()->addSecond());

    expect($period)->getStartDate()->toBeCarbon('2020-03-29 00:00:00')
        ->getEndDate()->toBeCarbon('2020-04-28 23:59:59');
});
